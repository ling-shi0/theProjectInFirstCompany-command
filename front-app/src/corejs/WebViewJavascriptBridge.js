(function(){if(window.WebViewJavascriptBridge){return}let messagingIframe;let sendMessageQueue=[];let receiveMessageQueue=[];const messageHandlers={};const CUSTOM_PROTOCOL_SCHEME_IOS='https';const BRIDGE_LOADED_IOS='__bridge_loaded__';const QUEUE_HAS_MESSAGE_IOS='__wvjb_queue_message__';const CUSTOM_PROTOCOL_SCHEME_ANDROID='yy';const QUEUE_HAS_MESSAGE_ANDROID='__QUEUE_MESSAGE__/';const responseCallbacks={};let uniqueId=1;const base64encodechars='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';function _createQueueReadyIframe(doc){messagingIframe=doc.createElement('iframe');messagingIframe.style.display='none';if(isIphone()){messagingIframe.src=CUSTOM_PROTOCOL_SCHEME_IOS+'://'+BRIDGE_LOADED_IOS}doc.documentElement.appendChild(messagingIframe)};function isAndroid(){const ua=navigator.userAgent.toLowerCase();const isA=ua.indexOf('android')>-1;if(isA){return true}return false};function isIphone(){const ua=navigator.userAgent.toLowerCase();const isIph=ua.indexOf('iphone')>-1||ua.indexOf('ipad')>-1;if(isIph){return true}return false};function init(messageHandler){if(WebViewJavascriptBridge._messageHandler){throw new Error('WebViewJavascriptBridge.init called twice');}WebViewJavascriptBridge._messageHandler=messageHandler;const receivedMessages=receiveMessageQueue;receiveMessageQueue=null;for(let i=0;i<receivedMessages.length;i++){_dispatchMessageFromNative(receivedMessages[i])}};function send(data,responseCallback){_doSend({data:data},responseCallback)};function registerHandler(handlerName,handler){messageHandlers[handlerName]=handler};function removeRegisterHandler(handlerName,handler){if(messageHandlers.hasOwnProperty(handlerName)){delete messageHandlers[handlerName];handler(`已取消注册${handlerName}方法`)}else{handler('查无此方法')}};function callHandler(handlerName,data,responseCallback){_doSend({handlerName:handlerName,data:data},responseCallback)};function _doSend(message,responseCallback){if(responseCallback){const callbackId='cb_'+(uniqueId++)+'_'+new Date().getTime();responseCallbacks[callbackId]=responseCallback;message.callbackId=callbackId}sendMessageQueue.push(message);if(isIphone()){messagingIframe.src=CUSTOM_PROTOCOL_SCHEME_IOS+'://'+QUEUE_HAS_MESSAGE_IOS}else if(isAndroid()){messagingIframe.src=CUSTOM_PROTOCOL_SCHEME_ANDROID+'://'+QUEUE_HAS_MESSAGE_ANDROID}}function _fetchQueue(){const messageQueueString=JSON.stringify(sendMessageQueue);sendMessageQueue=[];if(isIphone()){return messageQueueString}else if(isAndroid()){messagingIframe.src=CUSTOM_PROTOCOL_SCHEME_ANDROID+'://return/_fetchQueue/'+encodeURIComponent(messageQueueString)}}function _dispatchMessageFromNative(messageJSON){setTimeout(function(){const message=JSON.parse(messageJSON);let responseCallback;if(message.responseId){responseCallback=responseCallbacks[message.responseId];if(!responseCallback){return}responseCallback(message.responseData);if(JSON.parse(message.responseData).code!==1){delete responseCallbacks[message.responseId]}}else{if(message.callbackId){const callbackResponseId=message.callbackId;responseCallback=function(responseData){_doSend({responseId:callbackResponseId,responseData:responseData})}}let handler=WebViewJavascriptBridge._messageHandler;if(message.handlerName){handler=messageHandlers[message.handlerName]}try{handler(message.data,responseCallback)}catch(exception){if(typeof console!=='undefined'){console.log('WebViewJavascriptBridge: WARNING: javascript handler threw.',message,exception)}}}})}function _handleMessageFromNative(messageJSON){if(receiveMessageQueue){receiveMessageQueue.push(messageJSON)}else{_dispatchMessageFromNative(messageJSON)}}var WebViewJavascriptBridge=window.WebViewJavascriptBridge={init:init,send:send,registerHandler:registerHandler,removeRegisterHandler:removeRegisterHandler,callHandler:callHandler,_fetchQueue:_fetchQueue,_handleMessageFromNative:_handleMessageFromNative};const doc=document;_createQueueReadyIframe(doc);const readyEvent=doc.createEvent('Events');readyEvent.initEvent('WebViewJavascriptBridgeReady');readyEvent.bridge=WebViewJavascriptBridge;doc.dispatchEvent(readyEvent)})()